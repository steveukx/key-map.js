/*! key-map 2013-06-23 */
!function(a,b){"function"==typeof define&&define.amd?define(["jquery"],b):b(window.jQuery)}(this,function(a){function b(b){this._combos={},this._combo=[],this._isDoc=9===b.nodeType,a(b).on("keypress",(this._isDoc?this._onDocumentKeyPress:this._onKeyPress).bind(this)).on("keyup",this._onKeyUp.bind(this))}function c(c){var d=a.data(c,"keyMap");return d||a.data(c,"keyMap",d=new b(c)),d}function d(a,b){var d=c(a);for(var e in b)b.hasOwnProperty(e)&&d.on(e.toUpperCase(),b[e],a)}var e=0,f=1,g=2,h=0,i=1,j=2,k={27:"ESCAPE",8:"BKSPACE",46:"DELETE",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN"},l={13:"ENTER"},m=/[A-Z0-9 \/\\\-,\.;:]/i;Object.defineProperty(b.prototype,"duration",{get:function(){return this._duration},set:function(a){"number"==typeof a&&a>=1&&(this._duration=a)}}),b.prototype._duration=400,b.prototype._getEventType=function(){var a=this._combo.join(" "),b=h;for(var c in this._combos)if(0===c.indexOf(a)&&(b=c===a?i:j),b===j)break;return b},b.prototype._addStep=function(a,b,c){this._combo.push(((b?"SHIFT-":"")+(c?"CTRL-":"")+a).toLowerCase()),clearTimeout(this._timeoutId);var d=this._getEventType()===i;d&&!this._isDoc?this._trigger():this._timeoutId=setTimeout(this._trigger.bind(this),d?1:this._duration)},b.prototype._onDocumentKeyPress=function(a){" INPUT SELECT TEXTAREA ".indexOf(" "+a.currentTarget.nodeName+" ")<0&&this._onKeyPress(a)},b.prototype._onKeyPress=function(a){var b=l[a.which]||String.fromCharCode(a.which);m.test(b)&&this._addStep(b,a.shiftKey,a.ctrlKey)},b.prototype._onKeyUp=function(a){var b=k[a.which];b&&this._addStep(b,a.shiftKey,a.ctrlKey)},b.prototype._trigger=function(){clearTimeout(this._timeoutId);for(var a=this._combo.splice(0).join(" "),b=this._combos[a],c=0,d=b&&b.length;d>c;c++)try{b[c][0].call(b[c][1])}catch(e){"undefined"!=typeof console&&console.error(e)}},b.prototype.one=function(a,b,c){return this.on(a,b,c,!0)},b.prototype.on=function(a,b,c,d){var e=a.toLowerCase();return(this._combos[e]=this._combos[e]||[]).push([b,c,!!d]),this},b.prototype.off=function(a,b,c){var d=typeof a;if("undefined"===d)this._combos={};else if("string"===d)if(void 0===b)delete this._combos[a.toUpperCase()];else for(var e=this._combos[a.toUpperCase()],f="function"!=typeof b,g=e.length-1;g>=0;g--)e[g][f]!==b||c&&c!==e[g][1]||e.splice(g,1);else Object.keys(this._combos).forEach(function(c){this.off(c,a,b)},this);return this};var n=function(a,b,h){var i=arguments.length;return i==e?this.length?c(this[0]):null:(i==f?this.each(function(b,c){d(c,a)}):"function"==typeof b?this.each(function(d,e){c(e).on(a,b,h||e)}):i==g&&this.each(function(d,e){var f=c(e);f["set"+a]?f["set"+a](b):void 0!==f[a]&&(f[a]=b)}),this)};a.fn.keyMap=n,a.keyMap=function(){return n.apply(a(document),arguments)}});